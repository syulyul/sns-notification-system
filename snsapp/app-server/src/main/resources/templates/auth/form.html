<!DOCTYPE html>
<html>
<head>
  <meta charset='UTF-8'>
  <title>ì €ë¥¼ "íë§ë²„íŠ¼"ìœ¼ë¡œ ì“°ì„¸ìš”</title>
  <link rel="stylesheet" type="text/css" href="/css/font.css">
  <link rel="stylesheet" type="text/css" href="/css/auth/form.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="../../static/js/auth/form.js"></script>

</head>

<body>
<main id="main-holder">
  <div style="margin-bottom: 40px;"></div>
  <img src="/images/logo.png" alt="ë¡œê³ " class="logo">

  <div id="login-error-msg-holder">
    <p id="login-error-msg">Invalid username <span id="error-msg-second-line">and/or password</span>
    </p>
  </div>

  <form id="login-form" method="post">
    <!-- ì‚¬ìš©ì ì…ë ¥ í•„ë“œ -->
    <input style="font-size: 20px" type="text" name="phoneNumber" id="username-field" class="login-form-field"
           placeholder="ì „í™”ë²ˆí˜¸">
    <input style="font-size: 20px" type="password" name="password" id="password-field" class="login-form-field" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <input style="font-size: 20px" type="submit" value="ë¡œê·¸ì¸" id="login-form-submit">
    <label class="left-align">
      <input type='checkbox' name='savePhoneNumber' id='savePhoneNumber'> ì „í™”ë²ˆí˜¸ ì €ì¥
    </label>
    <ul>
      <a style="font-size: 20px" href="/auth/add" class="user-field"> ğŸŒ± íšŒì›ê°€ì…</a>
      <a style="font-size: 20px" href="/auth/find" class="user2-field"> ğŸŒ± ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
    </ul>
  </form>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const loginForm = document.getElementById("login-form");
      const loginErrorMsg = document.getElementById("login-error-msg");
      const savePhoneNumberCheckbox = document.getElementById("savePhoneNumber");

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¿ í‚¤ í™•ì¸
      const savedPhoneNumber = getCookie("savedPhoneNumber");
      if (savedPhoneNumber) {
        document.getElementById("username-field").value = savedPhoneNumber;
        savePhoneNumberCheckbox.checked = true;
      }

      loginForm.addEventListener("submit", function (event) {
        const phoneNumber = loginForm.querySelector("#username-field").value;
        const password = loginForm.querySelector("#password-field").value;

        if (savePhoneNumberCheckbox.checked) {
          // ì‚¬ìš©ìê°€ "ì „í™”ë²ˆí˜¸ ì €ì¥" ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•œ ê²½ìš°, ì¿ í‚¤ì— ì €ì¥
          setCookie("savedPhoneNumber", phoneNumber, 30); // 30ì¼ ë™ì•ˆ ì¿ í‚¤ ìœ ì§€
        } else {
          // ì„ íƒí•˜ì§€ ì•Šì€ ê²½ìš°, ì¿ í‚¤ ì‚­ì œ
          deleteCookie("savedPhoneNumber");
        }

        // Ajax ìš”ì²­ ë³´ë‚´ê¸°
        const xhr = new XMLHttpRequest();
        xhr.open("POST", "login", true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        xhr.onload = function () {
          if (xhr.status === 200) {
            // ë¡œê·¸ì¸ ì„±ê³µ
            loginErrorMsg.style.opacity = 0; // ì—ëŸ¬ ë©”ì‹œì§€ ê°ì¶”ê¸°
            alert("ë¡œê·¸ì¸ ì„±ê³µ ğŸŒ±");
            const responseData = JSON.parse(xhr.responseText); // JSON ì‘ë‹µ ë°ì´í„° íŒŒì‹±
            const userNo = responseData.userNo; // ì‚¬ìš©ì ë²ˆí˜¸ ì¶”ì¶œ
            location.href = `/myPage/${userNo}`; // ì‚¬ìš©ì ë²ˆí˜¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
          } else {
            // ë¡œê·¸ì¸ ì‹¤íŒ¨
            loginErrorMsg.style.opacity = 1; // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
            loginErrorMsg.innerText = "ë¡œê·¸ì¸ ì‹¤íŒ¨! ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”"; // ì—ëŸ¬ ë©”ì‹œì§€ ì„¤ì •
          }
        };

        // ìš”ì²­ ë³¸ë¬¸ ì„¤ì •
        const data = `phoneNumber=${phoneNumber}&password=${password}`;
        xhr.send(data);

        event.preventDefault(); // í¼ ì œì¶œ ë°©ì§€
      });

      // ì¿ í‚¤ ì„¤ì • í•¨ìˆ˜
      function setCookie(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        const expires = "expires=" + date.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/";
      }

      // ì¿ í‚¤ ì½ê¸° í•¨ìˆ˜
      function getCookie(name) {
        const decodedCookie = decodeURIComponent(document.cookie);
        const cookies = decodedCookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.startsWith(name + "=")) {
            return cookie.substring(name.length + 1);
          }
        }
        return null;
      }

      // ì¿ í‚¤ ì‚­ì œ í•¨ìˆ˜
      function deleteCookie(name) {
        document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      }
    });
  </script>
</main>
</body>
</html>
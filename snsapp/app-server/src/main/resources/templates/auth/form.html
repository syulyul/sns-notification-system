<!DOCTYPE html>
<html>
<head>
  <meta charset='UTF-8'>
  <title>íë§ìŠ¤íƒ€ê·¸ë¨</title>
  <link rel="stylesheet" type="text/css" href="/css/font.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script defer src="form.js"></script>

  <style>
    html {
      height: 100%;
    }

    body {
      height: 100%;
      margin: 0;
      display: grid;
      justify-items: center;
      align-items: center;
      background-color: #426B1F;
    }

    #main-holder {
      width: 70%;
      height: 80%;
      display: grid;
      justify-items: center;
      align-items: center;
      background-color: white;
      border-radius: 7px;
    }

    #login-error-msg-holder {
      width: 100%;
      height: 100%;
      display: grid;
      justify-items: center;
      align-items: center;
    }

    #login-error-msg {
      width: 23%;
      text-align: center;
      margin: 0;
      padding: 5px;
      font-size: 12px;
      font-weight: bold;
      color: #8a0000;
      border: 1px solid #8a0000;
      background-color: #e58f8f;
      opacity: 0;
    }

    #error-msg-second-line {
      display: block;
    }

    #login-form {
      align-self: flex-start;
      display: grid;
      justify-items: center;
      align-items: center;
    }

    .login-form-field::placeholder {
      color: #3a3a3a;
    }

    .login-form-field {
      border: none;
      border-bottom: 1px solid #f2f2f2;
      margin-bottom: 10px;
      border-radius: 3px;
      outline: none;
      padding: 0px 0px 5px 5px;
      height: 60px;
      width: 400px;
    }

    #login-form-submit {
      width: 100%;
      padding: 7px;
      border: none;
      border-radius: 5px;
      color: white;
      font-weight: bold;
      background-color: #426B1F;
      cursor: pointer;
      outline: none;
    }

    .user-field {
      display: block;
      width: 220px;
      height: 30px;
      margin: 0 auto;
    }

    .user2-field {
      display: block;
      width: 220px;
      height: 100px;
      margin: 0 auto;
    }

    @font-face {
      font-family: 'UhBeeKeongKeong';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_five@.2.0/UhBeeKeongKeong.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    body, p, h1, h2, h3, h4, h5, h6, textarea, input, button, a {
      font-family: 'UhBeeKeongKeong', sans-serif;
    }

    button {
      font-size: 20px;
    }

    body {
      font-size: 20px;
    }
  </style>
</head>

<body>
<main id="main-holder">
  <h1>ğŸŒ±íë§ìŠ¤íƒ€ê·¸ë¨ğŸŒ±</h1>

  <div id="login-error-msg-holder">
    <p id="login-error-msg">Invalid username <span id="error-msg-second-line">and/or password</span>
    </p>
  </div>

  <form id="login-form" method="post">
    <!-- ì‚¬ìš©ì ì…ë ¥ í•„ë“œ -->
    <input type="text" name="phoneNumber" id="username-field" class="login-form-field"
           placeholder="ì „í™”ë²ˆí˜¸">
    <input type="password" name="password" id="password-field" class="login-form-field" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <input type="submit" value="ë¡œê·¸ì¸" id="login-form-submit">
    <input type='checkbox' name='savePhoneNumber' id='savePhoneNumber'> ì „í™”ë²ˆí˜¸ ì €ì¥
    <ul>
      <li><a href="/auth/add" class="user-field"> íšŒì›ê°€ì…</a></li>
      <li><a href="/auth/find" class="user2-field"> ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a></li>
    </ul>


  </form>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const loginForm = document.getElementById("login-form");
      const loginErrorMsg = document.getElementById("login-error-msg");

      loginForm.addEventListener("submit", function (event) {
        const phoneNumber = loginForm.querySelector("#username-field").value;
        const password = loginForm.querySelector("#password-field").value;

        // Ajax ìš”ì²­ ë³´ë‚´ê¸°
        const xhr = new XMLHttpRequest();
        xhr.open("POST", "login", true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        xhr.onload = function () {
          if (xhr.status === 200) {
            // ë¡œê·¸ì¸ ì„±ê³µ
            loginErrorMsg.style.opacity = 0; // ì—ëŸ¬ ë©”ì‹œì§€ ê°ì¶”ê¸°
            alert("ë¡œê·¸ì¸ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.");
            const responseData = JSON.parse(xhr.responseText); // JSON ì‘ë‹µ ë°ì´í„° íŒŒì‹±
            const userNo = responseData.userNo; // ì‚¬ìš©ì ë²ˆí˜¸ ì¶”ì¶œ
            location.href = `/myPage/${userNo}`; // ì‚¬ìš©ì ë²ˆí˜¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
          } else {
            // ë¡œê·¸ì¸ ì‹¤íŒ¨
            loginErrorMsg.style.opacity = 1; // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
            loginErrorMsg.innerText = "ë¡œê·¸ì¸ ì‹¤íŒ¨, ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."; // ì—ëŸ¬ ë©”ì‹œì§€ ì„¤ì •
          }
        };

        // ìš”ì²­ ë³¸ë¬¸ ì„¤ì •
        const data = `phoneNumber=${phoneNumber}&password=${password}`;
        xhr.send(data);

        event.preventDefault(); // í¼ ì œì¶œ ë°©ì§€
      });
    });
  </script>
</main>
</body>
</html>
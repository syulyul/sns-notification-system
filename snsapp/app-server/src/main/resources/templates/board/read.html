<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>ë°©ëª…ë¡</title>
    <!-- ìŠ¤íƒ€ì¼ê³¼ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ê°€ í•„ìš”í•˜ë©´ ì—¬ê¸°ì— -->
    <style>
        table {
            width: 40%;
            border-collapse: collapse;
            margin: 0 auto;
            margin-bottom: 20px;
        }
        
        table,
        th,
        td {
            border: 1px solid #ccc;
        }
        
        th,
        td {
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
        }
        
        .scrollable-table {
            max-height: 300px;
            overflow-y: scroll;
        }
        
        .actions {
            text-align: center;
            padding: 16px;
            /* ë³€ê²½: ìƒí•˜ ì—¬ë°± ì¶”ê°€ */
            line-height: 15;
            /* ë³€ê²½: ì„¸ë¡œ í¬ê¸° 2ë°°ë¡œ ëŠ˜ë¦¼ */
        }
        
        button {
            padding: 5px 10px;
            background-color: #426B1F;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        button {
            float: inherit;
        }
        
        .actions button {
            padding: 5px 10px;
            margin: 5px;
            background-color: #426B1F;
            color: white;
            border: none;
            border-radius: 4px;
        }
        
        .content-table {
            width: 40%;
            border-collapse: collapse;
            background-color: #888888;
        }
        /* ë©”íƒ€ ì •ë³´ ë‚´ë¶€ ìš”ì†Œë“¤ì„ ê°€ë¡œë¡œ ë°°ì—´ */
        
        .meta-info {
            display: flex;
            align-items: center;
            gap: 10px;
            /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ì‚¬ì´ì˜ ê°„ê²© */
        }
        /* ì‹œê°„ê³¼ ë·° ì¹´ìš´íŠ¸ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
        
        .clock-icon {
            width: 16px;
            height: 16px;
        }
        
        .horizontal-layout {
            display: flex;
            align-items: center;
            justify-content: space-between;
            /* ì¶”ê°€ëœ ì†ì„± */
            gap: 20px;
        }
        /* ê²Œì‹œê¸€ ì œëª©ì„ ê°€ë¡œë¡œ ë°°ì—´í•˜ê¸° ìœ„í•œ ìŠ¤íƒ€ì¼ */
        
        h1 {
            margin: 0;
        }
        /* ë©”íƒ€ ì •ë³´ ë‚´ë¶€ ìš”ì†Œë“¤ì„ ê°€ë¡œë¡œ ë°°ì—´ */
        
        .meta-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .no-cell {
            width: 10%;
        }
        /* ì œëª©ê³¼ ë©”íƒ€ ì •ë³´ ì…€ ìŠ¤íƒ€ì¼ */
        
        .title-meta-cell {
            width: 40%;
        }
        /* ì‘ì„±ì ì…€ ìŠ¤íƒ€ì¼ */
        
        .writer-cell {
            width: 15%;
        }
        /* ë‚´ìš©ê³¼ ì¢‹ì•„ìš” ì…€ ìŠ¤íƒ€ì¼ */
        
        .content-like-cell {
            width: 35%;
        }
        
        .horizontal-layout {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        
        .first-row {
            background-color: #f2f2f2;
        }
        
        .second-row {
            background-color: white;
            height: 200px;
        }
        
        .hidden-file-input {
            opacity: 0;
            /* íˆ¬ëª…í•˜ê²Œ ë§Œë“¤ê¸° */
            position: absolute;
            /* í˜ì´ì§€ ë ˆì´ì•„ì›ƒì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê²Œ ìœ„ì¹˜ ì§€ì • */
            pointer-events: none;
            /* ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ë¬´ì‹œ */
        }
        
        .like-button {
            padding: 5px 10px;
            background-color: #ffffff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .unlike-button {
            padding: 5px 10px;
            background-color: #ffffff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="/css/header.css">

    <script>
        function toggleLikeButtons(boardNo) {
            const likeButton = document.getElementById('likeButton-' + boardNo);
            const unlikeButton = document.getElementById('unlikeButton-' + boardNo);

            // ë²„íŠ¼ì˜ í‘œì‹œ ìƒíƒœë¥¼ ì „í™˜
            if (likeButton.style.display === 'none' || likeButton.style.display === '') {
                likeButton.style.display = 'inline-block';
                unlikeButton.style.display = 'none';
            } else {
                likeButton.style.display = 'none';
                unlikeButton.style.display = 'inline-block';
            }
        }

        function likeButtonClicked(buttonElement) {
            const boardNo = buttonElement.getAttribute("data-board-no");

            fetch(`/board/like?boardNo=${boardNo}`, {
                    method: 'POST'
                })
                .then(response => {
                    if (response.ok) {
                        alert("ì¢‹ì•„ìš”ê°€ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        toggleLikeButtons(boardNo); // ë²„íŠ¼ ìƒíƒœ ì „í™˜ í•¨ìˆ˜ í˜¸ì¶œ
                    } else {
                        alert("ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    }
                });
        }

        function unlikeButtonClicked(buttonElement) {
            const boardNo = buttonElement.getAttribute("data-board-no");

            fetch(`/board/unlike?boardNo=${boardNo}`, {
                    method: 'POST'
                })
                .then(response => {
                    if (response.ok) {
                        alert("ì¢‹ì•„ìš” ì·¨ì†Œê°€ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        toggleLikeButtons(boardNo); // ë²„íŠ¼ ìƒíƒœ ì „í™˜ í•¨ìˆ˜ í˜¸ì¶œ
                    } else {
                        alert("ì¢‹ì•„ìš” ì·¨ì†Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    }
                });
        }
    </script>

</head>

<body>

    <div data-th-replace="header :: header"></div>

    <form data-th-action="@{/board/add}" method='post' enctype='multipart/form-data'>
        <table>
            <tr>
                <th>ì œëª©</th>
                <td><input type="text" name="title"></td>
            </tr>
            <tr>
                <th>ë‚´ìš©</th>
                <td><textarea name="content" rows="4"></textarea></td>
            </tr>
            <input type='hidden' name='category' data-th-value="${param.category}">
            <input type='file' name='files' class='hidden-file-input' multiple placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"><br>
            <!--íŒŒì¼ ì„ íƒ ë¶€ë¶„ íˆ¬ëª…ìœ¼ë¡œ ë°”ê¿”ì¤Œ -->
        </table>
        <div style="text-align: center; margin-left:40%; margin-top:10%">
            <button>ë“±ë¡</button>
        </div>
    </form>


    <!-- ê²Œì‹œê¸€ ëª©ë¡ì„ ì¶œë ¥í•˜ê¸° ìœ„í•œ Thymeleaf ë°˜ë³µë¬¸ -->
    <div data-th-each="board : ${list}">
        <div class="container">
            <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
            <table class="content-table">
                <!-- ì²« ë²ˆì§¸ í–‰: ë²ˆí˜¸, ì œëª©, ë©”íƒ€ ì •ë³´ -->
                <tr class="first-row">
                    <td class="no-cell">
                        <span th:text="${board.no}"></span>
                    </td>
                    <td class="title-meta-cell" colspan="3">
                        <div class="horizontal-layout">
                            <span th:text="${board.title}"></span>
                            <div class="meta-info">
                                <img class="clock-icon" src="/images/clock.png">
                                <span th:text="${#dates.format(board.createdAt, 'yyyy-MM-dd')}"></span>
                                <img class="clock-icon" src="/images/eye.png">
                                <span th:text="${board.viewCount}"></span>
                            </div>
                        </div>
                    </td>
                </tr>
                <!-- ë‘ ë²ˆì§¸ í–‰: ì‘ì„±ì, ë‚´ìš©, ì¢‹ì•„ìš” -->
                <tr class="second-row">
                    <td class="writer-cell">
                        <span th:text="${board.writer.name}"></span>
                        <span th:text="${board.writer.photo}"></span>
                    </td>
                    <td class="content-like-cell" colspan="3">
                        <span th:if="${board != null}" th:text="${board.content != null ? board.content : 'ë‚´ìš©ì…ë‹ˆë‹¤!'}"></span>
                        <!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
                        <button class="like-button" th:id="'likeButton-' + ${board.no}" th:if="${!likedBoards.contains(board.no)}" th:attr="data-board-no=${board.no}" onclick="likeButtonClicked(this)">
                        ğŸ¤
                    </button>

                        <!-- ì¢‹ì•„ìš” ì·¨ì†Œ (ì¢‹ì•„ìš” ëˆŒëŸ¬ì ¸ìˆëŠ”ìƒíƒœ) ë²„íŠ¼ -->
                        <button class="unlike-button" th:id="'unlikeButton-' + ${board.no}" th:if="${likedBoards.contains(board.no)}" th:attr="data-board-no=${board.no}" onclick="unlikeButtonClicked(this)">
                        â¤ï¸
                    </button>
                    </td>
                </tr>
            </table>
            <div class="btn-container">
                <a data-th-href="@{/board/delete(category=${board != null ? board.category : 'default'},no=${board != null ? board.no : '0'})}">
                    <button>ì‚­ì œ</button>
                </a>
            </div>
        </div>
    </div>
    <div data-th-replace="footer :: footer"></div>
</body>

</html>